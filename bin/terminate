#!/usr/bin/env bash
set -eu
set -o pipefail

script_path="$(realpath "$(dirname "$0")")"
secrets_bin="${script_path}/secrets"

case "$1" in
    base|tozt|algo|mail|partofme)
        "$secrets_bin" open
        trap '"$secrets_bin" close' EXIT
        doctl -t "$(cat /mnt/digitalocean)" compute droplet delete "$1"
        ;;
    *)
        echo "unknown host $1" >&2
        exit 1
        ;;
esac
